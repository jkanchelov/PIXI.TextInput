"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}!function(){var t=function(t){function i(i){var s;return(s=t.call(this)||this)._input_style=Object.assign({position:"absolute",background:"none",border:"none",outline:"none",transformOrigin:"0 0",lineHeight:"1"},i.input),i.box?s._box_generator="function"==typeof i.box?i.box:new e(i.box):s._box_generator=null,s._input_style.hasOwnProperty("multiline")?(s._multiline=!!s._input_style.multiline,delete s._input_style.multiline):s._multiline=!1,s._box_cache={},s._previous={},s._dom_added=!1,s._dom_visible=!0,s._placeholder="",s._placeholderColor=11119017,s._createDOMInput(),s.substituteText=!0,s._setState("DEFAULT"),s._addListeners(),s}_inheritsLoose(i,t);var s=i.prototype;return s.focus=function(){this._substituted&&!this.dom_visible&&this._setDOMInputVisible(!0),this._dom_input.focus()},s.blur=function(){this._dom_input.blur()},s.select=function(){this.focus(),this._dom_input.select()},s.setInputStyle=function(t,e){this._input_style[t]=e,this._dom_input.style[t]=e,!this._substituted||"fontFamily"!==t&&"fontSize"!==t||this._updateFontMetrics(),this._last_renderer&&this._update()},s.destroy=function(e){this.destroyBoxCache(),t.prototype.destroy.call(this,e)},s._createDOMInput=function(){for(var t in this._multiline?(this._dom_input=document.createElement("textarea"),this._dom_input.style.resize="none"):(this._dom_input=document.createElement("input"),this._dom_input.type="text"),this._input_style)this._dom_input.style[t]=this._input_style[t]},s._addListeners=function(){this.on("added",this._onAdded.bind(this)),this.on("removed",this._onRemoved.bind(this)),this._dom_input.addEventListener("keydown",this._onInputKeyDown.bind(this)),this._dom_input.addEventListener("input",this._onInputInput.bind(this)),this._dom_input.addEventListener("keyup",this._onInputKeyUp.bind(this)),this._dom_input.addEventListener("focus",this._onFocused.bind(this)),this._dom_input.addEventListener("blur",this._onBlurred.bind(this))},s._onInputKeyDown=function(t){this.emit("keydown",t.keyCode)},s._onInputInput=function(t){this._substituted&&this._updateSubstitution(),this.emit("input",this.text)},s._onInputKeyUp=function(t){this.emit("keyup",t.keyCode)},s._onFocused=function(){this._setState("FOCUSED"),this.emit("focus")},s._onBlurred=function(){this._setState("DEFAULT"),this.emit("blur")},s._onAdded=function(){document.body.appendChild(this._dom_input),this._dom_input.style.display="none",this._dom_added=!0},s._onRemoved=function(){document.body.removeChild(this._dom_input),this._dom_added=!1},s._setState=function(t){this.state=t,this._updateBox(),this._substituted&&this._updateSubstitution()},s.renderWebGL=function(e){t.prototype.renderWebGL.call(this,e),this._renderInternal(e)},s.renderCanvas=function(e){t.prototype.renderCanvas.call(this,e),this._renderInternal(e)},s.render=function(e){t.prototype.render.call(this,e),this._renderInternal(e)},s._renderInternal=function(t){this._resolution=t.resolution,this._last_renderer=t,this._canvas_bounds=this._getCanvasBounds(),this._needsUpdate()&&this._update()},s._update=function(){this._updateDOMInput(),this._substituted&&this._updateSurrogate(),this._updateBox()},s._updateBox=function(){this._box_generator&&(this._needsNewBoxCache()&&this._buildBoxCache(),this.state==this._previous.state&&this._box==this._box_cache[this.state]||(this._box&&this.removeChild(this._box),this._box=this._box_cache[this.state],this.addChildAt(this._box,0),this._previous.state=this.state))},s._updateSubstitution=function(){"FOCUSED"===this.state?(this._dom_visible=!0,this._surrogate.visible=0===this.text.length):(this._dom_visible=!1,this._surrogate.visible=!0),this._updateDOMInput(),this._updateSurrogate()},s._updateDOMInput=function(){this._canvas_bounds&&(this._dom_input.style.top=this._canvas_bounds.top+"px",this._dom_input.style.left=this._canvas_bounds.left+"px",this._dom_input.style.transform=this._pixiMatrixToCSS(this._getDOMRelativeWorldTransform()),this._dom_input.style.opacity=this.worldAlpha,this._setDOMInputVisible(this.worldVisible&&this._dom_visible),this._previous.canvas_bounds=this._canvas_bounds,this._previous.world_transform=this.worldTransform.clone(),this._previous.world_alpha=this.worldAlpha,this._previous.world_visible=this.worldVisible)},s._needsUpdate=function(){return!this._comparePixiMatrices(this.worldTransform,this._previous.world_transform)||!this._compareClientRects(this._canvas_bounds,this._previous.canvas_bounds)||this.worldAlpha!=this._previous.world_alpha||this.worldVisible!=this._previous.world_visible},s._needsNewBoxCache=function(){var t=this._getDOMInputBounds();return!this._previous.input_bounds||t.width!=this._previous.input_bounds.width||t.height!=this._previous.input_bounds.height},s._createSurrogate=function(){this._surrogate_hitbox=new PIXI.Graphics,this._surrogate_hitbox.alpha=0,this._surrogate_hitbox.interactive=!0,this._surrogate_hitbox.cursor="text",this._surrogate_hitbox.on("pointerdown",this._onSurrogateFocus.bind(this)),this.addChild(this._surrogate_hitbox),this._surrogate_mask=new PIXI.Graphics,this.addChild(this._surrogate_mask),this._surrogate=new PIXI.Text("",{}),this.addChild(this._surrogate),this._surrogate.mask=this._surrogate_mask,this._updateFontMetrics(),this._updateSurrogate()},s._updateSurrogate=function(){var t=this._deriveSurrogatePadding(),e=this._getDOMInputBounds();this._surrogate.style=this._deriveSurrogateStyle(),this._surrogate.style.padding=Math.max.apply(Math,t),this._surrogate.y=this._multiline?t[0]:(e.height-this._surrogate.height)/2,this._surrogate.x=t[3],this._surrogate.text=this._deriveSurrogateText(),this._updateSurrogateHitbox(e),this._updateSurrogateMask(e,t)},s._updateSurrogateHitbox=function(t){this._surrogate_hitbox.clear(),this._surrogate_hitbox.beginFill(0),this._surrogate_hitbox.drawRect(0,0,t.width,t.height),this._surrogate_hitbox.endFill(),this._surrogate_hitbox.interactive=!this._disabled},s._updateSurrogateMask=function(t,e){this._surrogate_mask.clear(),this._surrogate_mask.beginFill(0),this._surrogate_mask.drawRect(e[3],0,t.width-e[3]-e[1],t.height),this._surrogate_mask.endFill()},s._destroySurrogate=function(){this._surrogate&&(this.removeChild(this._surrogate),this.removeChild(this._surrogate_hitbox),this._surrogate.destroy(),this._surrogate_hitbox.destroy(),this._surrogate=null,this._surrogate_hitbox=null)},s._onSurrogateFocus=function(){this._setDOMInputVisible(!0),setTimeout(this._ensureFocus.bind(this),10)},s._ensureFocus=function(){this._hasFocus()||this.focus()},s._deriveSurrogateStyle=function(){var t=new PIXI.TextStyle;for(var e in this._input_style)switch(e){case"color":t.fill=this._input_style.color;break;case"fontFamily":case"fontSize":case"fontWeight":case"fontVariant":case"fontStyle":t[e]=this._input_style[e]}return this._multiline&&(t.lineHeight=parseFloat(t.fontSize),t.wordWrap=!0,t.wordWrapWidth=this._getDOMInputBounds().width),0===this._dom_input.value.length&&(t.fill=this._placeholderColor),t},s._deriveSurrogatePadding=function(){if(this._input_style.padding&&this._input_style.padding.length>0){var t=this._input_style.padding.trim().split(" ");if(1==t.length){var e=parseFloat(t[0]);return[e,e,e,e]}if(2==t.length){var i=parseFloat(t[0]),s=parseFloat(t[1]);return[i,s,i,s]}if(4==t.length)return t.map(function(t){return parseFloat(t)})}return[0,0,0,0]},s._deriveSurrogateText=function(){return 0===this._dom_input.value.length?this._placeholder:this._dom_input.value},s._updateFontMetrics=function(){var t=this._deriveSurrogateStyle().toFontString();this._font_metrics=PIXI.TextMetrics.measureFont(t)},s._buildBoxCache=function(){this._destroyBoxCache();var t=["DEFAULT","FOCUSED","DISABLED"],e=this._getDOMInputBounds();for(var i in t)this._box_cache[t[i]]=this._box_generator(e.width,e.height,t[i]);this._previous.input_bounds=e},s._destroyBoxCache=function(){for(var t in this._box&&(this.removeChild(this._box),this._box=null),this._box_cache)this._box_cache[t].destroy(),this._box_cache[t]=null,delete this._box_cache[t]},s._hasFocus=function(){return document.activeElement===this._dom_input},s._setDOMInputVisible=function(t){this._dom_input.style.display=t?"block":"none"},s._getCanvasBounds=function(){var t=this._last_renderer.view.getBoundingClientRect(),e={top:t.top,left:t.left,width:t.width,height:t.height};return e.left+=window.scrollX,e.top+=window.scrollY,e},s._getDOMInputBounds=function(){var t=!1;this._dom_added||(document.body.appendChild(this._dom_input),t=!0);var e=this._dom_input.style.transform,i=this._dom_input.style.display;this._dom_input.style.transform="",this._dom_input.style.display="block";var s=this._dom_input.getBoundingClientRect();return this._dom_input.style.transform=e,this._dom_input.style.display=i,t&&document.body.removeChild(this._dom_input),s},s._getDOMRelativeWorldTransform=function(){var t=this._last_renderer.view.getBoundingClientRect(),e=this.worldTransform.clone();return e.scale(this._resolution,this._resolution),e.scale(t.width/this._last_renderer.width,t.height/this._last_renderer.height),e},s._pixiMatrixToCSS=function(t){return"matrix("+[t.a,t.b,t.c,t.d,t.tx,t.ty].join(",")+")"},s._comparePixiMatrices=function(t,e){return!(!t||!e)&&(t.a==e.a&&t.b==e.b&&t.c==e.c&&t.d==e.d&&t.tx==e.tx&&t.ty==e.ty)},s._compareClientRects=function(t,e){return!(!t||!e)&&(t.left==e.left&&t.top==e.top&&t.width==e.width&&t.height==e.height)},_createClass(i,[{key:"substituteText",get:function(){return this._substituted},set:function(t){this._substituted!=t&&(this._substituted=t,t?(this._createSurrogate(),this._dom_visible=!1):(this._destroySurrogate(),this._dom_visible=!0),this.placeholder=this._placeholder,this._update())}},{key:"placeholder",get:function(){return this._placeholder},set:function(t){this._placeholder=t,this._substituted?(this._updateSurrogate(),this._dom_input.placeholder=""):this._dom_input.placeholder=t}},{key:"disabled",get:function(){return this._disabled},set:function(t){this._disabled=t,this._dom_input.disabled=t,this._setState(t?"DISABLED":"DEFAULT")}},{key:"text",get:function(){return this._dom_input.value},set:function(t){this._dom_input.value=t,this._substituted&&this._updateSurrogate()}},{key:"htmlInput",get:function(){return this._dom_input}}]),i}(PIXI.Container);function e(t){if((t=t||{fill:13421772}).default)t.focused=t.focused||t.default,t.disabled=t.disabled||t.default;else{var e=t;(t={}).default=t.focused=t.disabled=e}return function(e,i,s){var o=t[s.toLowerCase()],n=new PIXI.Graphics;return o.fill&&n.beginFill(o.fill),o.stroke&&n.lineStyle(o.stroke.width||1,o.stroke.color||0,o.stroke.alpha||1),o.rounded?n.drawRoundedRect(0,0,e,i,o.rounded):n.drawRect(0,0,e,i),n.endFill(),n.closePath(),n}}"object"===("undefined"==typeof PIXI?"undefined":_typeof(PIXI))?PIXI.TextInput=t:"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=t:console.warn("[PIXI.TextInput] could not attach to PIXI namespace. Make sure to include this plugin after pixi.js")}();